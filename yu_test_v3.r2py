"""
Modified from Prof. Zhuang's acclerometer.r2py and location_wifi.r2py
By Yu
"""

sensorlib = dy_import_module("sensorlib.r2py")

# get a connection to communicate with sensors
port = sensorlib.get_connectionport()
sensor_socket = sensorlib.getconnection(port)

# define sensor/method/arg in code: 
start_sensing(2, 0)

count = 0
starttime = getruntime()
MAX_TIME = 30

resultstring = "Time, x, y, z\n"
while(getruntime() - starttime < MAX_TIME):
  try:
    sensor_data = get_acceleration()
    #log(getruntime(), sensor_data, '\n')

    resultstring = resultstring + str(getruntime()) + ',' + str(sensor_data[0]) + ',' + str(sensor_data[1]) + ',' + str(sensor_data[2]) + '\n'

    count = count + 1
  except Exception as e:
    log(str(e), '\n')
    stop_sensing()
    sensor_socket.close()
    #raise

stop_sensing()
sensor_socket.close()

myfilelist = listfiles()
filename = "accelerometer_data"

if filename in myfilelist:
  removefile(filename)  
myfileobject = openfile(filename, True)
myfileobject.writeat(resultstring, 0)
myfileobject.close()

duration = (getruntime() - starttime) / count
log(str(duration))
